<mat-card class="eleve-form-card">
  <mat-card-header>
    <mat-card-title>
      <mat-icon>{{ isEditMode() ? 'edit' : 'person_add' }}</mat-icon>
      {{ isEditMode() ? 'Modifier l\'élève' : 'Nouvel élève' }}
    </mat-card-title>
  </mat-card-header>

  <mat-card-content>
    <form [formGroup]="eleveForm" (ngSubmit)="onSubmit()" class="eleve-form">

      <!-- Section Informations personnelles -->
      <div class="form-section">
        <h3 class="section-title">
          <mat-icon>person</mat-icon>
          Informations personnelles
        </h3>

        <div class="form-row">
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Civilité</mat-label>
            <mat-select formControlName="civilite">
              @if (civiliteLoading()) {
              <mat-option disabled>
                <mat-spinner diameter="16"></mat-spinner>
                Chargement...
              </mat-option>
              } @else {
              @for (civilite of civilitesOptions(); track civilite.id) {
              <mat-option [value]="civilite">{{ civilite.libelle }}</mat-option>
              }
              }
            </mat-select>
            @if (hasError('civilite')) {
            <mat-error>{{ getErrorMessage('civilite') }}</mat-error>
            }
          </mat-form-field>

          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Nom *</mat-label>
            <input matInput formControlName="nom" placeholder="Nom de famille">
            @if (hasError('nom')) {
            <mat-error>{{ getErrorMessage('nom') }}</mat-error>
            }
          </mat-form-field>

          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Prénom *</mat-label>
            <input matInput formControlName="prenom" placeholder="Prénom">
            @if (hasError('prenom')) {
            <mat-error>{{ getErrorMessage('prenom') }}</mat-error>
            }
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Date de naissance</mat-label>
            <input matInput [matDatepicker]="picker" formControlName="dateNaissance">
            <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-datepicker #picker></mat-datepicker>
          </mat-form-field>

          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Email</mat-label>
            <input matInput formControlName="email" type="email" placeholder="email@exemple.com">
            <mat-icon matSuffix>email</mat-icon>
            @if (hasError('email')) {
            <mat-error>{{ getErrorMessage('email') }}</mat-error>
            }
          </mat-form-field>

          <div class="form-field">
            <mat-checkbox formControlName="emailValide">
              Email validé
            </mat-checkbox>
          </div>
        </div>
      </div>

      <!-- Section Contact -->
      <div class="form-section">
        <h3 class="section-title">
          <mat-icon>phone</mat-icon>
          Contact
        </h3>

        <div class="form-row">
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Téléphone</mat-label>
            <input matInput formControlName="telephone" placeholder="01 23 45 67 89">
            <mat-icon matSuffix>phone</mat-icon>
          </mat-form-field>

          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Portable</mat-label>
            <input matInput formControlName="portable" placeholder="06 12 34 56 78">
            <mat-icon matSuffix>smartphone</mat-icon>
          </mat-form-field>
        </div>
      </div>

      <!-- Section Adresse -->
      <div class="form-section">
        <h3 class="section-title">
          <mat-icon>location_on</mat-icon>
          Adresse
        </h3>

        <div class="form-row">
          <mat-form-field appearance="outline" class="form-field-full">
            <mat-label>Adresse</mat-label>
            <input matInput formControlName="adresse" placeholder="Numéro et nom de rue">
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Code postal</mat-label>
            <input matInput formControlName="codePostal" placeholder="75000">
          </mat-form-field>

          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Ville</mat-label>
            <input matInput formControlName="ville" placeholder="Paris">
          </mat-form-field>

          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Pays</mat-label>
            <input matInput formControlName="pays" placeholder="France">
          </mat-form-field>
        </div>
      </div>

      <!-- Section Familles -->
      <div class="form-section">
        <h3 class="section-title">
          <mat-icon>family_restroom</mat-icon>
          Familles
        </h3>
        <app-chips-autocomplete [options]="options$" placeholder="Rechercher un parent" [(items)]="parents"
          label="Parents"></app-chips-autocomplete>

        <app-chips-autocomplete [options]="options$" placeholder="Rechercher un enfant" [(items)]="enfants"
          label="Enfants"></app-chips-autocomplete>
      </div>

      <!-- Section Registre -->
      <div class="form-section">
        <h3 class="section-title">
          <mat-icon>school</mat-icon>
          Informations registre
        </h3>

        <div class="form-row">
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Centre *</mat-label>
            <mat-select formControlName="centre">
              @if (centresLoading()) {
              <mat-option disabled>
                <mat-spinner diameter="16"></mat-spinner>
                Chargement...
              </mat-option>
              } @else {
              @for (centre of centresOptions(); track centre.id) {
              <mat-option [value]="centre">{{ centre.libelle }}</mat-option>
              }
              }
            </mat-select>
            @if (hasError('centre')) {
            <mat-error>{{ getErrorMessage('centre') }}</mat-error>
            }
          </mat-form-field>

          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Type de membre *</mat-label>
            <mat-select formControlName="typeMembre">
              @if (aspectsLoading()) {
              <mat-option disabled>
                <mat-spinner diameter="16"></mat-spinner>
                Chargement...
              </mat-option>
              } @else {
              @for (aspect of aspectsOptions(); track aspect.id) {
              <mat-option [value]="aspect">{{ aspect.libelle }}</mat-option>
              }
              }
            </mat-select>
            @if (hasError('typeMembre')) {
            <mat-error>{{ getErrorMessage('typeMembre') }}</mat-error>
            }
          </mat-form-field>

          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Statut *</mat-label>
            <mat-select formControlName="statut">
              @if (statutsLoading()) {
              <mat-option disabled>
                <mat-spinner diameter="16"></mat-spinner>
                Chargement...
              </mat-option>
              } @else {
              @for (statut of statutsOptions(); track statut.id) {
              <mat-option [value]="statut">{{ statut.libelle }}</mat-option>
              }
              }
            </mat-select>
            @if (hasError('statut')) {
            <mat-error>{{ getErrorMessage('statut') }}</mat-error>
            }
          </mat-form-field>
        </div>
      </div>

      <!-- Section Informations complémentaires -->
      <div class="form-section">
        <h3 class="section-title">
          <mat-icon>info</mat-icon>
          Informations complémentaires
        </h3>

        <div class="form-row">
          <mat-form-field appearance="outline" class="form-field-full">
            <mat-label>Profession</mat-label>
            <input matInput formControlName="profession" placeholder="Profession ou métier">
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline" class="form-field-full">
            <mat-label>Connaissances</mat-label>
            <textarea matInput formControlName="connaissances" rows="3"
              placeholder="Connaissances ou compétences particulières"></textarea>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline" class="form-field-full">
            <mat-label>Commentaires</mat-label>
            <textarea matInput formControlName="commentaires" rows="3"
              placeholder="Commentaires ou remarques"></textarea>
          </mat-form-field>
        </div>
      </div>

    </form>
  </mat-card-content>

  <mat-card-actions align="end" class="form-actions">
    <button mat-button type="button" (click)="onCancel()" [disabled]="saving()">
      Annuler
    </button>
    <button mat-raised-button color="primary" type="submit" (click)="onSubmit()"
      [disabled]="saving() || eleveForm.invalid">
      @if (saving()) {
      <mat-spinner diameter="16"></mat-spinner>
      }
      {{ isEditMode() ? 'Modifier' : 'Créer' }}
    </button>
  </mat-card-actions>
</mat-card>